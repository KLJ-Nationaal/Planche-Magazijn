<form
  [formGroup]="form"
  (ngSubmit)="submit()"
  (keydown.enter)="$event.preventDefault()"
  class="form"
>
  <h2>Bestelling aanmaken</h2>

  <div class="group">
    <div class="row two-col">
      <div class="w-100">
        <p-floatLabel variant="on">
          <input
            pInputText
            id="name"
            type="text"
            formControlName="name"
            class="w-100"
          />
          <label for="name">Naam van Bestelling</label>
        </p-floatLabel>

        @if (hasError('name', 'required')) {
          <small class="p-error">Naam is verplicht.</small>
        }
        @if (hasError('name', 'minlength')) {
          <small class="p-error">Naam moet minstens 2 karakters bevatten.</small>
        }
      </div>
    </div>

    <div class="row two-col">
      <div class="w-100">
        <p-floatLabel variant="on">
          <input
            pInputText
            id="goalActivity"
            type="text"
            formControlName="goalActivity"
            class="w-100"
          />
          <label for="goalActivity">Doel activiteit</label>
        </p-floatLabel>

        @if (hasError('goalActivity', 'required')) {
          <small class="p-error">Geef een doel op.</small>
        }
      </div>

      <div class="w-100 location-field">
        <p-floatLabel variant="on">
          <input
            pInputText
            id="location"
            type="text"
            formControlName="location"
            class="w-100"
          />
          <label for="location">Locatie</label>
        </p-floatLabel>
      </div>
    </div>
  </div>

  <div class="group">
    <div class="row two-col">
      <div class="timing-block w-100">
        <div class="timing-title">Timing</div>

        <div class="timing-row">
          <p-floatLabel>
            <p-select
              inputId="fromDay"
              [options]="dayOptions"
              optionLabel="label"
              optionValue="value"
              formControlName="fromDay"
              appendTo="body"
            ></p-select>
            <label for="fromDay">Dag</label>
          </p-floatLabel>

          <p-floatLabel>
            <p-datepicker
              inputId="fromTime"
              formControlName="fromTime"
              [timeOnly]="true"
              hourFormat="24"
              [stepMinute]="15"
              appendTo="body"
            ></p-datepicker>
            <label for="fromTime">From</label>
          </p-floatLabel>

          <i class="pi pi-minus timing-separator-icon" aria-hidden="true"></i>

          <p-floatLabel>
            <p-select
              inputId="toDay"
              [options]="dayOptions"
              optionLabel="label"
              optionValue="value"
              formControlName="toDay"
              appendTo="body"
            ></p-select>
            <label for="toDay">Dag</label>
          </p-floatLabel>

          <p-floatLabel>
            <p-datepicker
              inputId="toTime"
              formControlName="toTime"
              [timeOnly]="true"
              hourFormat="24"
              [stepMinute]="15"
              appendTo="body"
            ></p-datepicker>
            <label for="toTime">To</label>
          </p-floatLabel>
        </div>
      </div>
    </div>
  </div>

  <div class="group">
    <div class="row two-col">
      <div class="w-100">
        <p-floatLabel variant="on">
          <input
            pInputText
            id="responsibleName"
            type="text"
            formControlName="responsibleName"
            class="w-100"
          />
          <label for="responsibleName">Naam verantwoordelijke</label>
        </p-floatLabel>

        @if (hasError('responsibleName', 'required')) {
          <small class="p-error">Verantwoordelijke is verplicht.</small>
        }
        @if (hasError('responsibleName', 'minlength')) {
          <small class="p-error">
            Verantwoordelijke moet minstens 2 karakters bevatten.
          </small>
        }
      </div>
    </div>

    <div class="row two-col">
      <div class="w-100">
        <p-floatLabel variant="on">
          <input
            pInputText
            id="responsibleEmail"
            type="email"
            formControlName="responsibleEmail"
            class="w-100"
          />
          <label for="responsibleEmail">Email verantwoordelijke</label>
        </p-floatLabel>

        @if (hasError('responsibleEmail', 'required')) {
          <small class="p-error">Email is verplicht.</small>
        }
        @if (hasError('responsibleEmail', 'email')) {
          <small class="p-error">Ongeldig e-mailadres.</small>
        }
      </div>

      <div class="w-100">
        <p-floatLabel variant="on">
          <input
            pInputText
            id="responsiblePhone"
            type="tel"
            formControlName="responsiblePhone"
            inputmode="numeric"
            pattern="^\\+?[0-9]{6,15}$"
            class="w-100"
          />
          <label for="responsiblePhone">Telefoonnummer Verantwoordelijke</label>
        </p-floatLabel>

        @if (hasError('responsiblePhone', 'required')) {
          <small class="p-error">Telefoonnummer is verplicht.</small>
        }
        @if (hasError('responsiblePhone', 'pattern')) {
          <small class="p-error">
            Ongeldig telefoonnummer (gebruik enkel de landcode of enkel cijfers, tussen de 6 en 15 tekens).
          </small>
        }
      </div>
    </div>
  </div>

  <div class="grid-card">
    <ag-grid-angular
      class="ag-theme-quartz"
      style="width: 100%; height: 520px"
      [rowData]="rowData"
      [columnDefs]="columnDefs"
      [defaultColDef]="defaultColDef"
      [stopEditingWhenCellsLoseFocus]="true"
      (gridReady)="onGridReady($event)"
    >
    </ag-grid-angular>

    <div class="grid-footer">
      <p-button
        label="Nieuw item"
        icon="pi pi-plus"
        styleClass="btn-full"
        (onClick)="addRow(); $event.preventDefault(); $event.stopPropagation();"
      ></p-button>
    </div>
  </div>

  <div class="group">
    <p-floatLabel class="w-100" variant="on">
      <textarea
        pInputTextarea
        id="comment"
        rows="4"
        formControlName="comment"
        class="w-100"
      ></textarea>
      <label for="comment">Opmerkingen</label>
    </p-floatLabel>
  </div>

  <div class="form-section-padding">
    <div class="row actions">
      <p-button type="reset" label="Reset" severity="secondary" outlined="true"></p-button>
      <p-button type="submit" label="Opslaan" [disabled]="form.invalid"></p-button>
    </div>
  </div>
</form>
