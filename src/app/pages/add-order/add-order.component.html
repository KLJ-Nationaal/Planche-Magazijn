<form [formGroup]="form" (ngSubmit)="submit()" (keydown.enter)="$event.preventDefault()" class="form">
  <h2>Bestelling aanmaken</h2>
  <div class="group">
    <div class="row two-col">
      <mat-form-field appearance="outline" class="w-100">
        <mat-label>Naam van Bestelling</mat-label>
        <input matInput type="text" formControlName="name" />
        @if (hasError('name', 'required')) {
          <mat-error>Naam is verplicht.</mat-error>
        }
        @if (hasError('name', 'minlength')) {
          <mat-error>
            Naam moet minstens 2 karakters bevatten.
          </mat-error>
        }
      </mat-form-field>
    </div>
    <div class="row two-col">
      <mat-form-field appearance="outline" class="w-100">
        <mat-label>Doel activiteit</mat-label>
        <input matInput type="text" formControlName="goalActivity" />
        @if (hasError('goalActivity', 'required')) {
          <mat-error>Geef een doel op.</mat-error>
        }
      </mat-form-field>
      <mat-form-field appearance="outline" class="w-100 location-field">
        <mat-label>Locatie</mat-label>
        <input matInput type="text" formControlName="location" />
      </mat-form-field>
    </div>
  </div>

  <div class="group">
    <div class="row two-col">
      <div class="timing-block w-100">
        <div class="timing-title">Timing</div>

        <div class="timing-row">
          <mat-form-field appearance="outline">
            <mat-label>Dag</mat-label>
            <mat-select formControlName="fromDay">
              <mat-option value="friday">Vrijdag</mat-option>
              <mat-option value="saturday">Zaterdag</mat-option>
              <mat-option value="sunday">Zondag</mat-option>
            </mat-select>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>From</mat-label>
            <mat-timepicker #fromPicker interval="15m"></mat-timepicker>
            <input matInput [matTimepicker]="fromPicker" formControlName="fromTime" />
            <mat-timepicker-toggle matIconSuffix [for]="fromPicker"></mat-timepicker-toggle>
          </mat-form-field>

          <mat-icon class="timing-separator-icon">remove</mat-icon>

          <mat-form-field appearance="outline">
            <mat-label>Dag</mat-label>
            <mat-select formControlName="toDay">
              <mat-option value="friday">Vrijdag</mat-option>
              <mat-option value="saturday">Zaterdag</mat-option>
              <mat-option value="sunday">Zondag</mat-option>
            </mat-select>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>To</mat-label>
            <mat-timepicker #toPicker interval="15m"></mat-timepicker>
            <input matInput [matTimepicker]="toPicker" formControlName="toTime" />
            <mat-timepicker-toggle matIconSuffix [for]="toPicker"></mat-timepicker-toggle>
          </mat-form-field>
        </div>
      </div>
    </div>
  </div>

  <div class="group">
    <div class="row two-col">
      <mat-form-field appearance="outline" class="w-100">
        <mat-label>Naam Verantwoordelijke</mat-label>
        <input matInput type="text" formControlName="responsibleName" />
        @if (hasError('responsibleName', 'required')) {
          <mat-error>Verantwoordelijke is verplicht.</mat-error>
        }
        @if (hasError('responsibleName', 'minlength')) {
          <mat-error>
            Verantwoordelijke moet minstens 2 karakters bevatten.
          </mat-error>
        }
      </mat-form-field>
    </div>
    <div class="row two-col">
      <mat-form-field appearance="outline" class="w-100">
        <mat-label>Email verantwoordelijke</mat-label>
        <input matInput type="email" formControlName="responsibleEmail" />
        @if (hasError('responsibleEmail', 'required')) {
          <mat-error>Email is verplicht.</mat-error>
        }
        @if (hasError('responsibleEmail', 'email')) {
          <mat-error>Ongeldig e-mailadres.</mat-error>
        }
      </mat-form-field>
      <mat-form-field appearance="outline" class="w-100">
        <mat-label>Telefoonnummer Verantwoordelijke</mat-label>
        <input
          matInput
          type="tel"
          formControlName="responsiblePhone"
          inputmode="numeric"
          pattern="^\\+?[0-9]{6,15}$"
          />
          @if (hasError('responsiblePhone', 'required')) {
            <mat-error>Telefoonnummer is verplicht.</mat-error>
          }
          @if (hasError('responsiblePhone', 'pattern')) {
            <mat-error>
              Ongeldig telefoonnummer (gebruik enkel de landcode of enkel cijfers, tussen de 6 en 15 tekens).
            </mat-error>
          }
        </mat-form-field>
      </div>
    </div>
    <div class="grid-card">
      <ag-grid-angular
        class="ag-theme-quartz"
        style="width: 100%; height: 520px"
        [rowData]="rowData"
        [columnDefs]="columnDefs"
        [defaultColDef]="defaultColDef"
        [stopEditingWhenCellsLoseFocus]="true"
        (gridReady)="onGridReady($event)">
      </ag-grid-angular>
      <div class="grid-footer">
        <button class="btn btn-primary btn-full" (click)="addRow(); $event.preventDefault(); $event.stopPropagation();">âž• Nieuw item</button>
      </div>
    </div>

    <div class="group">
      <mat-form-field appearance="outline" class="w-100">
        <mat-label>Opmerkingen</mat-label>
        <textarea matInput rows="4" formControlName="comment"></textarea>
      </mat-form-field>
    </div>
    <div class="form-section-padding">
      <div class="row actions">
        <button mat-stroked-button type="reset">Reset</button>
        <button mat-raised-button color="primary" type="submit" [disabled]="form.invalid">Opslaan</button>
      </div>
    </div>
  </form>
